# 模块

nginx -V 的参数

以 --with 一直到 --with-cc-opt 都是nginx编译时开启或关联的模块

## http_stub_status_module

![image-20211004151132759](images/image-20211004151132759.png)

![image-20211004151142668](images/image-20211004151142668.png)

配置如下：

![image-20211004151852647](images/image-20211004151852647.png)

用于获取nginx的握手数、连接数，正在读，正在写，等待中的连接

## http_random_index_module

![image-20211004152712365](images/image-20211004152712365.png)

![image-20211004152722458](images/image-20211004152722458.png)

## http_sub_module

![image-20211004153145158](images/image-20211004153145158.png)

![image-20211004153250556](images/image-20211004153250556.png)

![image-20211004153712584](images/image-20211004153712584.png)

以上将把返回的页面的内容中第一个字符串\<a>imooc 替换成 \<a>IMOOC

配置 sub_filter_once off，则替换所有。

![image-20211004153357787](images/image-20211004153357787.png)

## 请求、连接限制

![image-20211004154411501](images/image-20211004154411501.png)

 ### 连接限制

![image-20211004160311315](images/image-20211004160311315.png)

### 请求限制

![image-20211004160445007](images/image-20211004160445007.png)

### 用例

![image-20211004161810659](images/image-20211004161810659.png)

配置完通过ab -n 40 -c 20 http:/xxx/test.html 发起40个请求，20个并发。进行测试。

绿色是连接限制，通过客户端ip的二进制作为限制条件，只允许一个连接。

红色是请求限制，通过客户端二进制ip进行限制，限制为每秒一个请求。burst是指延迟处理。

## 访问控制



![image-20211004162144459](images/image-20211004162144459.png)

![image-20211004162252982](images/image-20211004162252982.png)

address：ip地址     cidr：网段：121.36.15.0/24     unix：socket    all：所有

### 局限

![image-20211004164932928](images/image-20211004164932928.png)

### 解决

![image-20211004165216622](images/image-20211004165216622.png)

具体等后续

## 认证模块

![image-20211004165416916](images/image-20211004165416916.png)

使用：https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html

### 局限

依赖密码文件。管理低下。

### 解决

![image-20211004170237492](images/image-20211004170237492.png)

