# 动静分离

![image-20211005143003582](E:\dailynote\nginx\慕课nginx - now\images\image-20211005143003582.png)

通过location，使静态资源访问 /opt/app/code下的资源。.jsp类则访问后端服务器。

![image-20211005143129297](E:\dailynote\nginx\慕课nginx - now\images\image-20211005143129297.png)

# rewrite规则

场景：页面跳转、兼容性支持、展示效果、seo优化、后台维护页面、流量状态、安全（伪静态页面防黑客抓取）。

![image-20211005144810063](E:\dailynote\nginx\慕课nginx - now\images\image-20211005144810063.png)

![image-20211005145644889](E:\dailynote\nginx\慕课nginx - now\images\image-20211005145644889.png)

## 案例1

![image-20211005150821804](E:\dailynote\nginx\慕课nginx - now\images\image-20211005150821804.png)

访问  host/break  和访问 host/last  和访问 host/test

结果

- host/test 正常200，且status：success
- host/break 404 ，因为被rewrite了，转到 /test 目录下，即在root配置的目录下找test目录。由于没有test目录，因此404
- host/last 结果同host/test。因为flag值是last ，即 /last 被rewrite成 /test 但是不是直接找文件内容，而是再发起一次请求。然后匹配到host/test。因此结果同host/test

break作用：资源分级

![image-20211005153550897](E:\dailynote\nginx\慕课nginx - now\images\image-20211005153550897.png)

## 案例2

 

![image-20211005152134545](E:\dailynote\nginx\慕课nginx - now\images\image-20211005152134545.png)

分别开启，结果

- redirect：会使得客户端发起两次请求，一次响应是302，并带上Location。然后客户端会对Location的地址发起请求，第二次响应200.
- permanent：同样是两次，但是当nginx关闭后，再次访问 /imooc，同样能重定向到rewrite配置的地址。因此第一次返回301，保存在客户端中。客户端接收到同样的请求，直接重定向到新地址，期间没有先去访问nginx。因此，后续都没有经过nginx

## 总结

break：rewrite单纯替换地址，不会有其他任何跳转，直接拿新地址在nginx上找资源。

last：rewrite替换地址后，进行一次服务器端跳转，即地址栏不变。

redirect：替换地址后，进行客户端跳转。

permanent： 第一次访问同redirect，不过状态码是301，后续再次访问，都不用经过nginx。

## 优先级

server的rewrite指令 》 location匹配 》 location的rewrite