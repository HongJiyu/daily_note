# 准备

```shell
yum -y install gcc gcc-c++ autoconf pcre ppcre-devel make automake
yum -y install wget httpd-tools vim

cd /opt;mkdir app download logs work backup
```

## 关闭防火墙规则

```shell
iptables -L  #查看规则
iptables -t nat -L #查看规则
iptables -F #关闭规则
iptables -t nat -F #关闭规则
```

## 关闭selinux

```shell
getenforce #查看
setenforce 0 # 关闭
```

# 使用nginx的原因

- io多路复用（todo）

由一个socket负责所有的io的状态上报并转发。因此只需要一个线程来负责，即服用同一个线程。

使用select而不是epoll

https://blog.csdn.net/lywzgzl/article/details/79163384

https://blog.csdn.net/wteruiycbqqvwt/article/details/90299610

- 轻量 （源代码只保留核心代码）

- cpu亲和 （每个工作进程绑定在固定cpu上）
- sendfile （linux2.2的零拷贝）

# nginx安装

https://nginx.org/  =》donwload =》pre-built 

![image-20211004110041033](images\image-20211004110041033.png)

![image-20211004110135473](images\image-20211004110135473.png)

使用yum list |grep 找到配置好的源 【nignx-stable】

直接yum install nginx 即可

# 基本参数使用

## 安装目录

rpm和yum的关系（todo），通过rpm可以知道yum安装的服务在操作系统上创建的文件

```shell
rpm -ql nginx
```

| --                                                      | --                                       |
| ------------------------------------------------------- | ---------------------------------------- |
| /etc/logrotate.d/nginx                                  | 日志切割配置文件                         |
| /etc/nginx/  (nginx.conf    conf.d/default.conf)        | 主配置文件（两者是包含关系）             |
| /etc/nginx/(fastcgi_params   uwsgi_params  scgi_params) | cgi和fastcgi配置                         |
| /etc/nginx/(koi-utf   koi-win   win-utf )               | 编码转换映射转化文件                     |
| /etc/nginx/mime.types                                   | http协议中Content-TYpe与扩展名的对应关系 |
|                                                         |                                          |

![image-20211004113429388](images\image-20211004113429388.png)

![image-20211004113505521](images\image-20211004113505521.png)

![image-20211004113518537](images\image-20211004113518537.png)

![image-20211004113542491](images\image-20211004113542491.png)

![image-20211004113602271](images\image-20211004113602271.png)

![image-20211004113635398](images\image-20211004113635398.png)

## 安装nginx时编译所用到的参数

```shell
nginx -V
```

```shell
--prefix=/usr/share/nginx --sbin-path=/usr/sbin/nginx --modules-path=/usr/lib64/nginx/modules --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --http-client-body-temp-path=/var/lib/nginx/tmp/client_body --http-proxy-temp-path=/var/lib/nginx/tmp/proxy --http-fastcgi-temp-path=/var/lib/nginx/tmp/fastcgi --http-uwsgi-temp-path=/var/lib/nginx/tmp/uwsgi --http-scgi-temp-path=/var/lib/nginx/tmp/scgi --pid-path=/run/nginx.pid --lock-path=/run/lock/subsys/nginx --user=nginx --group=nginx 
--with-compat --with-debug --with-file-aio --with-google_perftools_module --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_perl_module=dynamic --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-mail=dynamic --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream=dynamic --with-stream_ssl_module --with-stream_ssl_preread_module --with-threads --with-cc-opt='-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic' --with-ld-opt='-Wl,-z,relro -specs=/usr/lib/rpm/redhat/redhat-hardened-ld -Wl,-E'
```



![image-20211004114107664](images\image-20211004114107664.png)

![image-20211004114120751](images\image-20211004114120751.png)

![image-20211004114140286](images\image-20211004114140286.png)

![image-20211004114220574](images\image-20211004114220574.png)

![image-20211004114244255](images\image-20211004114244255.png)

## nginx.confg的配置

/etc/nginx/nginx.conf

nginx reload

nginx restart

### 存放日志位置

error.log 和http下的access log

![image-20211004143417062](images\image-20211004143417062.png)

remote_addr :客户端地址

remote_user: 客户端认证用户信息，得开启身份认证才行

time_local ：nginx的服务器时间

request ：请求行

status：响应状态码

body_bytes_sent ：响应字节数

http_referer：访问当前地址的上一级地址

http_user_agent：用户行为，从ie、谷歌、curl进行访问的。

http_x_forworded_for: todo



 nginx -t -c /etc/nginx/nginx.conf  检查指定路径下的配置文件的正确性

### nginx的日志变量

![image-20211004144304902](images\image-20211004144304902.png)

- http请求变量

$arg_\<parameter>

$sent_http_\<headFieldName>

$http_\<headFieldName>  比如想在accesslog打印出头部信息user-Agent。

加上:  '$http_user_agent' 即可，全部小写，横杠换成下划线，加美元符号

- 内置变量

![image-20211004144800882](images\image-20211004144800882.png)

