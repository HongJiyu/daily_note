egg-security

# csrf

防范csrf作用：用于保证用户是在自己系统页面操作的。

插件的操作：分为ctoken和refer两种，可以一起验证，可以只验证一种。

## ctoken

1. 基于cookie（使用csrf包生成token）

中间件每次都对本次请求重新在cookie设置一个新的token，前端每次都能从cookie拿到这个token，然后将其放到header，query参数或者body参数。

而后端每次都拿本次请求的cookie上的token 和前端一般放在头部的token 进行比较。因为只有自己系统页面才会将token放在头部，所以能验证成功。

如果黑客知道其中原理，并伪造cookie和header上的token，设置为一致，且符合`csrf`包的校验，则也能伪造。

2. 基于session

中间件每次都会重置session中的值，而后端会提供csrf值给前端（接口、写在模板等），每次请求接口后端通过session中的csrf和前端给过来的csrf值进行比较。

如果黑客拿到后端给前端的csrf，也能伪造。

**总结：其实前端通过拿到后端的csrf，可以放在query参数，body参数或者是header中，因为插件会从这三个地方获取。**

## refer

这种就是通过当前接口请求时所在的域名，refer就是用来放置域名的，后端配置可信任的refer即可。
