# 物理层

传输的是比特流，因此它定义了传输媒体接口的标准，用于屏蔽物理介质。按照标准来准确表示0和1即可。

# 数据链路层

提供了同一个子网下，主机间的通信。同时能够进行差错控制。

传输的是数据帧，将上层的ip数据包封装成帧（帧头部SOH+ip数据包+帧尾部EOT），透明传输、差错控制（crc冗余校验）、差错纠正。

协议：ppp，用于点对点，通过拨号，专线的方式建立点到点的连接。

以太网协议传输（局域网的一种技术），MTU最大是1500字节。

# 网络层

提供源主机到目的主机之间的通信线路。

传输的是数据报（数据报头+数据内容），有ip分片

报头包含：版本（ip4、ip6）、生存时间（ttl）、协议（tcp或udp）、源地址、目的地址、标识、标志、片偏移（和分片有关）

- 不需要连接、每个数据报单独路由、每个数据报有完整地址、不提供可靠的连接、到达终点无序、由终点进行差错控制

协议：arp、icmp、rip、ospf、ip

## icmp

用于网络诊断（ping）和线路追踪（traceroute）

Ping的本质其实就是ICMP回送请求报文和回送应答报文。

traceroute的本质是 发送端发送udp不可达的包，且路由接收后对ttl-1，为0则发送回显的icmp响应包。到达目的主机后，则发送主机不可达的icmp响应包

https://blog.csdn.net/yangliuhepanpan/article/details/51810049

## arp

arp协议在TCP/IP模型中属于IP层（网络层），在OSI模型中属于链路层

https://blog.csdn.net/lj_2_0_2/article/details/51383909

# 传输层

提供主机间不同进程之间的通信。基于端到端的传输服务。

有分组

## udp

无连接、尽最大努力交付、面向报文、不可靠

场景：直播、视频会话

首部：源端口、目的端口、16位udp长度、16位udp校验和

使用udp的应用层协议：dns、snmp、tftp、dhcp

## tcp

基于连接、可靠有序、不丢不重、面向字节流

tcp首部：源端口、目的端口、序列号、确认应答号、控制位、窗口

- 控制位 SYN=1 表示请求连接 ，ACK=1 表示应答号有效 ，FIN=1表示断开连接

停止等待协议、自动重传的arq、连续arq、流量控制、拥塞控制。

### 粘包

基于字节流传输。

1.由Nagle算法造成的发送端的粘包:Nagle算法是一种改善网络传输效率的算法.简单的说,当我们提交一段数据给TCP发送时,TCP并不立刻发送此段数据,而是等待一小段时间,看看在等待期间是否还有要发送的数据,若有则会一次把这两段数据发送出去.这是对Nagle算法一个简单的解释,详细的请看相关书籍. C和D的情况就有可能是Nagle算法造成的.
2.接收端接收不及时造成的接收端粘包:TCP会把接收到的数据存在自己的缓冲区中,然后通知应用层取数据.当应用层由于某些原因不能及时的把TCP的数据取出来,就会造成TCP缓冲区中存放了几段数据.
解决：分割符、指定长度。

http解决：使用content-length来指定长度

使用tcp的应用层协议：http、ftp、smtp

### 三次握手、四次挥手

![img]( https://lvxueyangboke.oss-cn-beijing.aliyuncs.com/images/20210827183118.awebp)

![img]( https://lvxueyangboke.oss-cn-beijing.aliyuncs.com/images/20210827183343.awebp)

MSL：max segment lifetime ， 最大报文生存时间。

2MSL = 4 min

### 拥塞

![image-20220404205000124](E:\dailynote\计算机网络\images\image-20220404205000124.png)

# 应用层

http、ftp、smtp

提供不同应用之间的通讯。定义进程间通讯和交互的规则，如数据格式、请求还是响应。

长连接和短连接。

## http

### 1.1

长连接、管道化、协商缓存、断点传输

Connection:keep-alive

### 1.2

二进制分帧（不再是报文）、多路复用（并行）、头部压缩、服务端推送

- 头部压缩

客户端和服务端维护一份静态字典，有类似的则只传输字典号即可。其他的则通过哈夫曼编码进行压缩。

- 服务端推送

服务端未卜先知，主动推送资源

get /index.html http/1.1

响应：index.html    style.css    scripts.js

### 报文

请求方法、请求地址、http版本

http版本、状态码、状态码解释

方法：get、post、put、delete、head（只返回响应头）、options（获取允许的方法）

## https

加密（对称加密）、身份认证（证书）、数据完整（传输的内容包含完整内容的摘要）。

tls握手采用非对称加密，通信时采用对称加密。

### 两组公钥私钥

服务器的公钥私钥（传输第三个随机数用到）

ca机构的公钥私钥（数字签名用到）

### 验证ca证书（ca证书内容是否被篡改）

证书中有证书签名（证书申请时的内容，进行hash，然后用ca的私钥加密）

浏览器拿到证书后，对证书内容进行hash，对证书签名进行解密（浏览器内置了各大ca机构的公钥），验证即可知道证书是否被篡改。

https://www.cnblogs.com/rinack/p/10743355.html

https://zhuanlan.zhihu.com/p/269827927

### 签名

用于明确身份。

公钥和私钥下，用私钥加密，私钥只存在一个人手中。因此能用公钥加密出来，就能保证这是私钥加密的。就能保证那个人的身份。

### 数据完整

https://www.zhihu.com/question/517582353/answer/2355981871

### https的问题

- 证书如果是自签的，可能存在问题。

- 加密导致性能有一定损耗

## dns

本地host文件=》浏览器操作系统缓存=》域名服务器。

https://blog.csdn.net/yanshuanche3765/article/details/82589210

- 迭代

本地域名服务器 =》根域名服务器

​							=》顶级域名服务器

​							=》权威域名服务器

- 递归

本地域名服务器 =》根 =》顶级=》权威 =》顶级=》根=》本地

# 安全

xss、csrf、ddos

## ddos

DDOS本是利用合理的请求造成资源过载，导致服务不可用。  常见的有syn_flood。

假设一个用户向服务器发送了SYN报文(第一次握手)后突然死机或掉线，那么服务器在发出SYN+ACK应答报文(第二次握手)后是无法收到客户端的ACK报文的(第三次握手无法完成)，这种情况下服务器端一般会重试(再次发送SYN+ACK给客户端)并等待一段时间后丢弃这个未完成的连接，这段时间的长度我们称为SYN Timeout，一般来说这个时间是分钟的数量级(大约为30秒-2分钟)；一个用户出现异常导致服务器的一个线程等待1分钟并不会对服务器端造成什么大的影响，但如果有大量的等待丢失的情况发生，服务器端将为了维护一个非常大的半连接请求而消耗非常多的资源。

如果一台主机负荷突然升高甚至失去响应，使用Netstat 命令能看到大量SYN_RCVD的半连接，可以认定，这台主机遭到了SYN Flood攻击。

**1、提高网络设备性能、网络带宽**

**5、增强操作系统的TCP/IP栈**

window系统：一旦服务器受到攻击，SYN半连接的数量超过TcpMaxHalfOpenRetried的设置，系统会认为自己受到了SYN Flood攻击，此时设置在SynAttackProtect键值中的选项开始作用，SYN Timeout时间被减短，SYN-ACK的重试次数减少，系统也会自动对缓冲区中的报文进行延时，避免对TCP/IP堆栈造成过大的冲击，力图将攻击危害减到最低;如果攻击强度不断增大，超过了TcpMaxHalfOpen值，此时系统已经不能提供正常的服务了，更重要的是保证系统不会崩溃，所以系统将会丢弃任何超出TcpMaxHalfOpen值范围的SYN报文(应该是使用随机丢包策略)，保证系统的稳定性。

**6、HTTP 请求的拦截**

HTTP 请求的特征一般有两种：IP 地址和 User Agent 字段。比如，恶意请求都是从某个 IP 段发出的，那么把这个 IP 段封掉就行。或者，它们的 User Agent 字段有特征(包含某个特定的词语)，那就把带有这个词语的请求拦截。

**7、部署CDN**

CDN 指的是网站的静态内容分发到多个服务器，用户就近访问，提高速度。因此，CDN 也是带宽扩容的一种方法，可以用来防御 DDOS 攻击。

**10、利用专业的安全防护产品**

### 防范手段

识别异常流量、分流异常流量、服务高可用部署、设置合理参数、实时监控告警。

# cdn

随着时代的发展，网民数量增多，访问路径过长，所以当用户与网站之间的链路被突发的大流量数据拥塞时，不同地区的用户访问网站的响应速度存在差异,为了提高用户访问的响应速度、优化现有Internet中信息的流动,需要在用户和服务器间加入中间层CDN。 
CDN将内容推送到网络边缘，大量的用户访问被分散在网络边缘，不再构成网站出口、互联互通点的资源挤占，也不再需要跨越长距离IP路由，即减少了源服务器的资源占用，企业大大提升了用户访问的响应时间，从而使用户能以最快的速度，从最接近用户的地方获得所需的信息，彻底解决网络拥塞，提高响应速度。 
CDN（Content Delivery Network），即内容分发网络。其目的是通过在现有的Internet中增加一层新的CACHE(缓存)层，将网站的内容发布到最接近用户的网络”边缘“的节点，使用户可以就近取得所需的内容，提高用户访问网站的响应速度。从技术上全面解决由于网络带宽小、用户访问量大、网点分布不均等原因，提高用户访问网站的响应速度。  

# epoll

### select 

1. 它仅仅知道了，有I/O事件发生了，却并不知道是哪那几个流（可能有一个，多个，甚至全部），只能无差别轮询所有流，找出能读出数据，或者写入数据的流，对他们进行操作。所以**select具有O(n)的无差别轮询复杂度**，同时处理的流越多，无差别轮询时间就越长。 
2. 单个进程可监视的fd_set(监听的端口个数)数量被限制：32位机默认是1024个，64位机默认是2048。 

### poll 

poll本质上和select没有区别，采用**[链表]()**的方式替换原有fd_set数据结构,而使其**没有连接数的限制**。 

### epoll 

1. 基于红黑树实现，同样没有链接限制。且插入和删除的时间复杂度是logN

1. 效率提升，不是轮询的方式，不会随着FD数目的增加效率下降。只有活跃可用的FD才会调用callback函数。即Epoll最大的优点就在于它只管你“活跃”的连接，而跟连接总数无关，因此在实际的网络环境中，Epoll的效率就会远远高于select和poll。 
2. epoll通过内核和用户空间映射到同一块物理内存来实现的。减少了数据交互拷贝的开销。
3. epoll有EPOLLLT和EPOLLET两种触发模式。(**暂时不去记，有个印象，大致是什么样就可以**) 

# 扩展

tcp分组、ip分片：https://blog.csdn.net/weixin_30385925/article/details/97532494

子网和网段：https://www.cnblogs.com/fjhnn/p/15612047.html

子网和不同子网之间的传输：https://blog.csdn.net/lj_2_0_2/article/details/51383909

